# 第三章 进程与线程

## 第一节 多道程序设计

### 一、程序的顺序执行

#### 1、顺序程序设计

* 程序在一个时间上按严格次序前后相继的操作序列
* 计算机也是以顺序方式工作的：计算机一次执行一条指令、对内存一次访问一个字节或字，对外部设备一次传送一个数据块等
* 我们把一个具有独立功能的程序独占处理器直到得到最终结果的过程称为程序的顺序执行

#### 2、程序的顺序执行的特点

1. 顺序性
   * 程序所规定的动作在机器上严格的按顺序执行

2. 封闭性
   * 程序运行后，其计算结果只取决于程序自身，程序执行得到的最终结果由给定的初始条件决定，不受外界因素影响

3. 程序执行结果的确定性
   * 程序执行的结果与其执行的速度无关

4. 程序执行结果的可在现性
   * 如果程序在不同的时间执行，只要初始条件相同，则结果就会相同

### 二、程序的并发执行

* 所谓并发执行，是指两个或者两个以上程序在计算机系统中，同时处于已开始执行且尚未结束的状态
* 能够参与并发执行的程序称为并发程序
* 并发程序的执行和程序顺序执行的特征不同

#### 1、并发执行的特征如下

1. 在执行期间并发程序相互制约

2. 程序与计算机不在一一对应。允许多个程序共享一个程序段

3. 并发程序的执行结果不可在现

   并发程序与其执行的相对速度以及并发执行的多道程序之间的相互关系有关

4. 程序的并发执行和程序的并行执行

   程序的并发执行是宏观上的同时，微观是顺序。并行则是微观上是同时的

#### 2、多道程序设计技术引入

a)  顺序环境下

![](F:\自考\操作系统\img\2020-05-18_162034.jpg)

CPU的利用率= 40/80=50%

`DEV1`的利用率=15/80=18.75%

`DEV2`的利用率=25/80=31.25%

b) 并发环境

![](F:\自考\操作系统\img\FastStoneEditor.jpg)

CPU的利用率= 40/45=89%

`DEV1`的利用率=15/45=33%

`DEV2`的利用率=25/45=56%

#### 3、多道程序设计环境特点

* 多道程序设计：就是允许多个程序同进入内存并运行。根本目的是提高整个系统的效率。
* 吞吐量：指单位时间内系统所处理进程的道数，是衡量系统效率的尺度。

1. 独立性
   * 在多道环境下执行的每道程序都是逻辑上独立的，且执行速度与其他程序无关，执行的气质时间也是独立的

2. 随机性
   * 程序和数据的输入与执行开始时间都是随机的

3. 资源共享性

#### 4、多道程序设计环境缺陷

1. 可能延迟程序的执行时间
2. 系统效率的提高有一定限度

![](F:\自考\操作系统\img\FastStoneEditor.jpg)

## 第二节 进程

### 一、进程的定义

进程是具有一定独立功能的程序在某个数据集合上的一次运行活动，是系统进行资源分配和调度的一个独立单位

分为：系统进程和用户进程

#### 1、进程与程序的联系和区别

* 进程和程序的联系
  * 程序是构成进程的组成部分之一，一个进程的运行目标是执行它所对应是程序
  * 进程=程序+数据+进程控制块

* 进程和程序的区别
  * 程序是静态的，进程是动态的
  * 二者是多对多的关系

#### 2、可再入程序

* 一个能够被多个用户同时调用的程序称作是“可再入”程序。
* 可再入程序必须是纯代码，程序在执行过程中不会修改自己的代码，必须与数据区隔离。
* 比如：操作系统、编译程序，他们能同时被不同的用户调用而形成不同的进程。

#### 3、进程的特征

1. 并发性
2. 动态性
3. 独立性
4. 交往性
5. 异步性
6. 结构性        程序+数据+进程控制块(PCB)

### 二、进程的状态与转换

#### 1、三状态进程模型

1. 运行状态
2. 就绪状态
3. 等待(阻塞)状态

* 状态转换
  1. 就绪  -》 运行
  2. 运行  -》 就绪 
  3. 运行 -》 等待
  4. 等待 -》 就绪

![](F:\自考\操作系统\img\2020-05-18_172223.jpg)

#### 2、五状态进程模型

1. 运行状态

2. 就绪状态

3. 阻塞状态

4. 创建状态

5. 结束状态

   ![](F:\自考\操作系统\img\2020-05-18_172943.jpg)

#### 3、七状态进程模型

![](F:\自考\操作系统\img\2020-05-18_173236.jpg)

### 三、进程控制块

* 为了便于系统控制和描述进程的活动过程，在操作系统核心中定义了一个专门的数据结构，称为PCB

PCB的作用：

* 描述进程的基本情况以及进程的运行变化过程
* PCB是进程存在的唯一标识，当系统创建一个进程时，为进程设置一个PCB，在利用PCB对进程进行控制和管理。撤销进程时，系统收回PCB，进程也随之消亡

#### 1、PCB的内容

1. 调度信息

   供进程调度时使用，包括进程名、进程号、地址空间信息、优先级、当前状态、资源清单、“家族”关系、消息队列指针、进程队列指针和当前打开文件等。

2. 现场信息

   刻画了进程的运行情况，主要是CPU寄存器的信息，如程序状态字、时钟、界地址寄存器等。当程序中断时，需要保存现场信息。

#### 2、进程的组成

进程是由程序、数据和进程控制块组成

PCB 是 “灵魂”

程序和数据是 “躯体”

#### 3、PCB阻止

1. 线性方式
2. 索引方式
3. 链接方式

![](F:\自考\操作系统\img\2020-05-18_175533.jpg)

![](F:\自考\操作系统\img\2020-05-18_175754.jpg)

#### 4、进程的队列

1. 就绪队列           1个或多个
2. 等待队列            多个
3. 运行队列             根据`cpu`

![](F:\自考\操作系统\img\2020-05-18_175937.jpg)

#### 5、进程队列的组成

* 进程队列实际是PCB的链接，链接分为：单向链表和双向链表。
* 出队：一个进程从所在队列退出。（也存在三种情况）
* 入队：一个进程排入到指定队列。
  * 从队首入队成为新的队首进程。
  * 从队尾入队成为新的队尾进程。
  * 插入到队列中某两个进程之间。
* 插队：一个进程插入到某个进程队列的指定位置。

### 四、进程控制

进程控制：

* 对进程整个生命周期中各种状态之间的转换进行控制。

* 由原语实现

原语：

就是由若干条指令组成，用于完成一定功能的一个过程，是一个不可分割的基本单位，即原语在执行过程中不允许被中断。原子操作在系统态下执行，常驻内存。