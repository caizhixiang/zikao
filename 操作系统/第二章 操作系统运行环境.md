# 第二章 操作系统运行环境

## 第一节 处理器

### 一、处理器的构成与基本工作方式

* 处理器一般有运算器、控制器和一系列寄存器以及高速缓存构成
* 运算器实际算数与逻辑运算
* 控制器控制程序运行流程
* 寄存器用于处理器执行指令的过程中缓存数据、地址及指令信息

* 高速缓存：为CPU和内存提供一个告诉的数据缓存区。

1. 处理器中的寄存器

   两类寄存器：

   * 用户可见寄存器，由编译程序分配，减少程序运行时访问内存的次数。一般包括数据寄存器，地址寄存器、条件码寄存器。
   * 控制和状态寄存器，用来控制处理器的操作。常见的寄存器是程序计数器（PC）、指令寄存器（IR）、程序状态字（`PSW`）。

2. 指令执行的基本过程

   最简单的两个步骤

   * 读取指令，并将程序计数器的值变成下一条指令的地址
   * 指令放入指令寄存器中，处理器解析并执行改指令

   指令的分配：

   访问存储器指令、I/O指令、算数逻辑指令、控制转移指令、控制器控制指令。

### 二、特权指令和非特权指令

在`多道程序`环境下，指令分为特权指令和非特权指令。

1. 特权指令：
   * 在操作系统中那些只能由操作系统使用的指令。
   * 不允许一般用户使用
   * 比如：设置程序状态字、启动某设备、设置中断屏蔽字等。

2. 非特权指令
   * 普通用户使用的指令

### 三、处理器的工作状态

1. 管态和目态
   * 管态： 操作系统管理程序运行时的状态，又称内核状态、系统态等，具有较高特权
   * 目态：一般用户程序运行时的状态，又称用户态、普通态，具有较低特权。

2. 处理器工作状态的转换
   * 目态到管态的转换：唯一途径是通过中断。中断响应时交换中断向量，新的中断向量的`PSW`的处理器状态标志位管态
   * 管态到目态的转换：可通过设置`PSW`指令，实现从操作系统到用户程序的转换。

3. 限制用户程序执行特权指令
   * 当用户程序执行时，如果取到了一条特权指令，则处理器拒绝执行该指令，并形成一个“非法操作”事件。然后操作系统通知用户程序---程序中有非法指令。

### 四、程序状态字

* 为了解决处理器当前工作状态的问题，所有的处理器都有有一些特殊寄存器，用以表明处理器当前的工作状态。用来指示处理器状态的寄存器，称为程序状态字。
* 比如：进位标志、`ZF`:结果为零标志等。

![](F:\自考\操作系统\img\2020-05-14_204344.jpg)

程序状态字一般包括：

* CPU的工作状态码： 指明当前的工作状态是管态还是目态
* 条件码： 反映指令执行后的结果特征，比如结果为0等
* 中断屏蔽码：指出是否允许中断

##  第二节 计算机系统硬件部件

### 一、存储系统

1. 存储器的类型

   * 类型
     * 读写型存储器（RAM）,用来存储随机存取的程序和数据
     * 只读存储器（ROM）,存放一些固化的程序

   * 存储分块
     * 存储的最小单位：位（bit）
     * 最小编制单位： 字节
     * 分块：为了分配和管理方便，将内存划分为大小相等的快（物理页page）,以块为单位分配内存空间，大小一般为`512B`,`1KB`、`4KB`、`8KB`等

2. 存储器的结构层次结构

   * 容量、速度和成本的匹配

     ![](F:\自考\操作系统\img\2020-05-14_214154.jpg)

   * 存储器访问局部性原理

     * 程序执行时，除了少部分的转移和过程调用指令外，在大多数情况下是顺序执行的
     * 过程调用将会使程序的执行轨迹，由一部分区域转至另一部分区域。即程序将会在一段时间内，都局限在这些过程的范围内运行
     * 程序中存在许多循环结构，这些虽然只有少数指令构成，但是他们将多次执行
     * 程序中还包括许多对数据结构的处理，如对数组进行操作，它们往往都局限于很小的范围内
     * 基于这一原理，设计多级存储的体系结构

   * 存储器保护

     * 多道程序设计系统中，保证每个程序独立运行，互不干扰，称为存储器保护
     * 方法：界地址寄存器

### 二、I/O部件

1. I/O结构
2. 通道
3. `DMA`技术
4. 缓冲技术

### 三、时钟部件

#### 功能：

(1) 发现死循环，防止机时的浪费

(2) 分时系统中，时钟间隔实现时间片轮转执行

(3) 实时系统中，按要求的时间间隔控制设备

(4) 定时唤醒各个外部事件

(5) 记录各种设备的使用时间和某外部事件发生的时间间隔

(6) 记录用户和系统所需的绝对事件，即年、月、日

#### 分类：

* 硬件时钟和软件时钟
* 用途分：绝对时钟和想多时钟