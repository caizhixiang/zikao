# 第五章 死锁

## 第一节 死锁的产生

### 一、死锁的定义

​		指在多道程序系统中，一组进程中的每一个进程均无限期的等待被该组进程中的了另一个进程所占用且永远不会释放的资源。

​		处于死锁状态的进程称为死锁进程。

### 二、死锁产生的原因

#### 1、资源的概念

1. 永久性资源(可重用资源)

   如内存、外部设备、处理器等硬件资源。

   各种数据文件、表格、共享程序代码等软件资源。

2. 临时性资源(消耗性资源)

   指由某个进程产生、只为另一个进程使用一次或经过短暂时间后便不在使用的资源。

   如I/O和时钟中断信号、同步信号、消息等。

#### 2、产生死锁的原因

1. 竞争资源

   系统在资源分配时出现失误、进程间对资源相互争夺而造成僵局。

2. 进程推进顺序不合理

#####  1、申请不同类资源产生死锁

1. 进程`P1`和`P2`在运行中使用输入、输出设备，假定系统中只有一台输入设备和一台输出设备，则进程`P1`和`P2`可有如下形势：

![](F:\自考\操作系统\img\2020-05-19_162528.jpg)

如果进程交替执行，如下：

* `P1`：申请一台输入设备
* `P2`：申请一台输出设备
* `P1`：申请一台输出设备
* `P2`：申请一台输入设备

![](F:\自考\操作系统\img\2020-05-19_162836.jpg)

##### 2、申请同类资源产生死锁

假设有一类可重用资源R，如内存，它包含m个页面，由n个进程`P1`、`P2`，...，`Pn(2<=m<=n)`共享。假定每个进程按下述顺序依次申请和释放页面：

1. 申请一个页面
2. 申请一个页面
3. 释放一个页面
4. 释放一个页面

n=3, m=2的情况

![](F:\自考\操作系统\img\2020-05-19_163640.jpg)

##### 3、P、V操作使用不当产生的死锁

​		对于第四章 生产者---消费者问题，如果把`P(mutex)`放在`P(empty)`和`P(Full)`之前，就会产生死锁

考虑当：

* empty=0， full = n 的情况

  第一种情况：假设生产者进程占有处理器，此时，执行完`P(mutex)`,在执行`P(empty)`时，生产者进程阻塞，让出处理器，消费者进程执行`P(mutex)`也会阻塞，此时产生死锁。

* empty=n， full = 0 的情况

  第二种情况：假设消费者进程占有处理器，此时，执行完`P(mutex)`,在执行`P(full)`时，消费者进程阻塞，让出处理器，生产者进程执行`P(mutex)`也会阻塞，此时产生死锁。

##### 4、对临时性资源的使用不加限制产生死锁

​		在进程通信时使用的信件可以看做是一种临时性资源，如果对信件的发送和接收不加限制，则可能引起死锁

​		比如，进程`P1`等待进程`P3`的信件`S3`，`S3`到来后再向进程`P2`发送信件`S1`，`P2`又要等待`P1`的信件`S1`到来后在向`P3`发送信件`S2`，`P3`进程也要等待进程`P2`的信件`S2`到来后才能发送信件`S3`。

|                                                 |                                                 |
| ----------------------------------------------- | ----------------------------------------------- |
| ![](F:\自考\操作系统\img\2020-05-19_170628.jpg) | ![](F:\自考\操作系统\img\2020-05-19_171000.jpg) |

##### 4、对临时性资源的使用不加限制产生死锁 --不产生死锁

|                                                 |                                                 |
| ----------------------------------------------- | ----------------------------------------------- |
| ![](F:\自考\操作系统\img\2020-05-19_171232.jpg) | ![](F:\自考\操作系统\img\2020-05-19_171000.jpg) |

### 三、产生死锁的四个必要条件

对于永久性资源，产生死锁的四个必要条件：

- 互斥条件
- 不可剥夺条件
- 请求和保持条件
- 循环等待条件

### 四、解决死锁的方法

- 预防死锁
- 避免死锁
- 检测与解除死锁
- 忽略死锁