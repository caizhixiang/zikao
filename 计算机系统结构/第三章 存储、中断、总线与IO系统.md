第三章 存储、中断、总线与I/O系统

## 一、存储系统的基本要求和并行主存系统

### 1、存储系统的基本要求

- 从用户的角度来看,存储器的三个主要指标：

  ​	**容量、速度和价格**(指每位价格)

- 人们对这三个指标的要求

​		容量大、速度快、价格低

- 三个要求是相互矛盾的

  ​	速度越快,每位价格就越高;

  ​	容量越大,每位价格就越低;

  ​	容量越大,速度越慢。

### 2、单体单字和单体多字

![](F:\自考\计算机系统结构\img\2020-05-27_150604.jpg)...![](F:\自考\计算机系统结构\img\2020-05-27_151027.jpg)

### 3、多体单字交叉存储器

![](F:\自考\计算机系统结构\img\2020-05-27_152612.jpg)

### 4、并行存储系统

 能并行读出多个CPU字的单体多字和多体单字、多体多字、多体多字的交叉访问主存系统统称为并行主存系统

![](F:\自考\计算机系统结构\img\2020-05-27_154843.jpg)

## 二、中断系统

 中断系统是计算机的重要组成部分。

 实时控制、故障自动处理、计算机与外围设备的数据传送往往采用中断系统。

 中断系统的应用大大提高了计算机效率。

![](F:\自考\计算机系统结构\img\2020-05-27_155359.jpg)

### 1、中断

 CPU暂停当前的工作,转去处理要求迅速处理的事件，处理完后,继续原来的工作

### 2、  中断服务/处理程序

```
 void ISRname (void)  interrupt   n [ using m ] 
 函数类型      ———— 无参数， 无返回值
 ISRname      ———— 中断服务函数名称，由用户定义
 interrupt    ———— n是中断编号，指示中断向量
 
 示例 ：定时器O的中断服务函数
 void timeOISR(void) interrupt 1 
 {
 	tnOsTimeTick();
 }
 注意：上述n和m 有下划线 中断程序接收0，返回0
```

### 3、 中断向量

 CPU响应中断时跳转到一个特定的地址开始执行中断服务程序，这个地址就是中断向量

![](F:\自考\计算机系统结构\img\2020-05-27_161233.jpg)

### 4、 几个中断基本概念

|     中断源     |                引起中断的各种事件                 |
| :------------: | :-----------------------------------------------: |
|  **中断请求**  |      **中断源向中断系统发出请求中断的申请**       |
|  **中断响应**  | **允许其中断CPU现行程序的运行，转去中断处理程序** |
|  **中断使能**  |       **允许CPU响应中断请求，做出中断处理**       |
|  **中断屏蔽**  |       **阻止CPU响应中断请求，禁止中断处理**       |
| **中断优先级** |            **指示中断请求的紧迫程度**             |
|  **中断嵌套**  |     **在进行禁止中断处理时应高优先级的中断**      |

### 5、中断源

① 机器故障中断。

② “异常”、程序性中断。一是程序性错误，二是缠身特殊的运算结果,例如定点溢出;三是程序出现某些预先确定要跟踪的事件,跟踪操作主要用于程序调用。

③ 输入输出设备中断。

④ 外中断。来自控制台中断开关、计时器、时钟或者其他设备,这类中断的处理较简单,实时性强。

⑤ 调用管理程序。用户程序利用指令“调用管理程序”中断请求,是用户程序和操作系统之间的联系桥梁。

### 6、中断嵌套

 发生条件： 低优先级中断正在处理的时候,高优先级中断请求有效

![](F:\自考\计算机系统结构\img\2020-05-27_162911.jpg)

 中断嵌套处理机制： 高优先级中断抢先处理，处理完后，继续处理被抢占的低优先级的中断

### 7、 轮询通信流程图与中断驱动流程图

请求服务：在处理任务4的时候外围部件请求服务

轮询缺点：只能在查询到有请求的时候才能提供服务，请求的时间不确定，导致响应时间不稳定。

![](F:\自考\计算机系统结构\img\2020-05-27_163951.jpg)

![](F:\自考\计算机系统结构\img\2020-05-27_164003.jpg)

### 8 、中断响应硬件原理

![](F:\自考\计算机系统结构\img\2020-05-27_165004.jpg)

### 9、 中断系统的软硬件功能分配

 中断系统的软、硬件功能分配实质上就是中断处理程序软件和中断响应硬件的功能分配。

 中断系统的功能包括中断请求的保存和清除、优先级的确定、中断断点及现场的保存、对中断请求的分析处理以及中断返回等,这些全是由中断响应硬件和中断处理程序共同完成的。

## 三、总线系统

### 1、 总线的概念

​		总线(Bus)是一组信号线的集合,它定义了各引线的信号、电气和机械特性,使计算机系统内部的各部件之间以及外部的各系统之间建立信号联系,进行数据传递和通信。

 		同一时刻只能有一个信息源(模块或设备) 发送信息。

​		多模块传输信息采用分时操作。

### 2、 总线的分类

 #### 按照计算机所传输的信息种类：

1. **数据总线**：双向,有8根(字节)，16根（字），32根（双字）

2. **地址总线**：单向,由CPU发出,指定信息源或目的地的地址。有20根(8086)，24根（80286），32根（80386及以后的CPU）

3. **控制总线**：单双向都有,控制读写，数据传输，联络，总线判决和中断控制等功能。

4. **电源总线**：供电

####  按照总线在系统结构中的层次位置，总线可分为

1. 片内总线（On-Chip BUS）：在集成电路内部,用来连接各功能单元的信息通路

2. 内部总线（Internal Bus）：用于计算机内部模块(板)之间通信

3. 外部总线（External Bus）：又称通讯总线

    用于计算机之间或计算机与设备之间通信

###  3、控制方式

- **集中式控制**：如果总线控制逻辑基本上集中放在一起,不论是放在连接到总线的一个部件中,还是放在单独的硬件中,都称为集中式控制。

- **分布式总线控制**：而当总线控制逻辑分散于连到总线的各个部件中时，就称为分布式总线控制。

### 4、同步与异步

- **同步总线**：包含一个供总线上所有设备使用的时钟,并且这些设备是基于该时钟按照一个固定的协议来发送地址和数据的。
  -  优点:速度快、成本低。
  -  缺点:总线操作都必须以同样的时钟频率进行

- **异步总线**： 没有统一的参考时钟,每个设备都有各自的定时方法。

   采用握手协议。

### 5、I/O系统软件层次结构

![](F:\自考\计算机系统结构\img\2020-05-27_171800.jpg)

### 6、 总线性能指标

| 总线频率 | 总线工作时钟频率                | MHz   |
| -------- | ------------------------------- | ----- |
| 总线位宽 | 总线数据线的根数,有8,16,32,64位 | bit   |
| 总线带宽 | 总线传输率                      | Mb /S |

 总线带宽 = 总线位宽 × 总线频率         Mb /S

 总线带宽 = 1 / 8总线位宽 × 总线频率    MB /S

### 7、机器中的总线

![](F:\自考\计算机系统结构\img\2020-05-27_172451.jpg)

### 8、设计总线时需要考虑的一些问题

| 特性         | 高性能                                   | 低                                      |
| :----------- | :--------------------------------------- | :-------------------------------------- |
| 总线宽度     | 独立的地址和数据总线                     | 数据和地址分时共用                      |
| 数据总线宽度 | 越宽越快(例如:64位)                      | 越窄越便宜（例如：8位）                 |
| 传输块大小   | 块越大总线开销越小                       | 单字传送更简单                          |
| 总线主设备   | 多个(需要仲裁)                           | 单个(无需仲裁）                         |
| 分离事务     | 采用——分离的请求包和回答包能提高总线带宽 | 不采用——持续连接成本，更低,而且延迟更小 |
| 定时方式     | 同步                                     | 异步                                    |

### 9、 几种常用并行I/O总线

|                  | `IDE  /  Ultra ATA` | `SCSI`                                                       | `PCI` | `PCI-X`    |
| ---------------- | ------------------- | ------------------------------------------------------------ | ----- | ---------- |
| 数据宽度(b)      | 16                  | 8/16                                                         | 32/64 | 32/64      |
| 时钟频率(MHz)    | 100                 | `10 ( Fast) 20 (UItra )  40 (UItra 2)  80 (UItra3)  160 ( UItra4)` | 33/66 | 66/100/133 |
| 总线主设备数量   | 1个                 | 多个                                                         | 多个  | 多个       |
| 峰值带宽(`MBps`) | 200                 | 320                                                          | 533   | 1066       |
| 533              | 异步                | 异步                                                         | 同步  | 同步       |
| 标准             | 无                  | `ANSI X3 .131`                                               | 无    | 无         |

### 10、 嵌入式系统中使用较多的4种串行I/O 总线

|                  | `I^2C`  | 1-wire | RS-232     | `SPI` |
| ---------------- | ------- | ------ | ---------- | ----- |
| 数据宽度(b)      | 1       | 1      | 2          | 1     |
| 信号线数量       | 2       | 1      | 9/25       | 3     |
| 时钟频率(MHz)    | 0.4~10  | 异步   | 0.04或异步 | 异步  |
| 总线主设备数量   | 多个    | 多个   | 多个       | 多个  |
| 峰值带宽(`Mbps`) | 0.4~3.4 | 0.014  | 0.192      | 1     |
| 同步方式         | 异步    | 异步   | 异步       | 异步  |



## 四、I/O系统

