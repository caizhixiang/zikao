# 第四章 存储体系

## 一、基本概念

数据在哪里存放：

- 寄存器Register  --- PC、 IR

- Cache   -----    Static Random Access Memory (` SRAM ` 静态随机存储器)

- DRAM  -----  `SDRAM ( SynchronousDRAM )`

  ```
   DDR       SDRAM  同步动态RAM
   DDRII     SDRAM 
   DDRIII    SDRAM 
  ```

- ROM ---- Read Only Menu

  ```
  ROM
  PROM
  EPROM
  EEPROM 
  ```

- Flash Memory   -----   RAM + ROM

  ```
  NOR Flash   随机的读写性能好
  NAND Flash  快读写性能很好
  ```

- `SSD`硬盘

- 磁盘(硬盘)   -----  数据依靠电和磁转换

- 光盘

  ```
  VCD 、 DVD、 蓝光DVD
  ```

- 磁带   ----   数据磁带
- 软盘
- 云存储（网盘）

不同存储介质具备不同的特点

| 存储        | 性能       | 容量    | 价格          |
| ----------- | ---------- | ------- | ------------- |
| Register    | `1ns`      | `32*4B` |               |
| Cache       | `1~10ns`   | KB~MB   | `~￥200/1M`   |
| Main memory | `50~100ns` | GB      | `~￥150/1G`   |
| `SSD` Disk  | ms         | GB      | `~￥200/100G` |
| Disk        | 7200/分    | TB      | `~￥400/1T`   |
| Tape        | s          | TB      | `~￥600/1T`   |

### 1、存储系统的基本要求

 		容量大、速度快、价格低

​		选用生产与运行成本不同的、存储容量不同、读写速度不同的多种存储介质,组成一个统一的存储器系统，使每种介质都处于不同的地位,发挥不同的作用,充分发挥各自在速度、 容量、成本方面的优势,从而达到最优性能比，以满足使用要求。

### 2、层次存储器系统

用容量更小但速度最快的`SRAM`芯片组成CACHE ,容量较大速度适中的DRAM芯片组 成MAIN MEMORY , 用容量特大但速度极慢的磁盘设备构成VIRTUAL  MEMORY 。

![](F:\自考\计算机系统结构\img\2020-05-27_231448.jpg)

1. **层次存储器系统 -----  程序的局部性原理**

![](F:\自考\计算机系统结构\img\2020-05-27_231854.jpg)

2. **主存 ------ 辅存存贮层次**

   从整体上看，速度使主存的，容量是辅存的

3. **Cache ---- 辅存存贮层次**

   从CPU看，速度是Cache的，容量是主存的

### 3、存储层次的性能参数

![](F:\自考\计算机系统结构\img\2020-05-27_233440.jpg)

S -----  容量

TA ----- 访问时间

C ----- 每位价格

每位价格C  ![](F:\自考\计算机系统结构\img\2020-05-27_233726.jpg)

命中率H: CPU访问存储系统时，在`M1`中找到所需信息的概率。

`R1` —— 访问`M1`的次数

`R2` —— 访问`M2`的次数

![](F:\自考\计算机系统结构\img\2020-05-27_233733.jpg)

失效率： F = 1 - H

平均访问时间：![](F:\自考\计算机系统结构\img\2020-05-27_234527.jpg)

## 二、虚拟存储器

1. 虚拟存储器是“主存一辅存”层次进一步发展的结果。虚拟存储器按照管理方式可分为:段式、页式和段页式

2. 基于局部性原理

3. 虚拟地址与物理地址之间转换：动态

4. 进程可分成几块(页/段)，且这些块可分别存储到内存的不连续区域里

5. 逻辑地址表示的内存空间即是虚拟存储（虚拟内存）

### 1、 虚拟存储:部分加载

1. 运行时进程的所有页/段不必都在内存里

   只要下一条要执行的指令和下一个要访问的数据在内内存里即可

2. 内存中可同时容纳更多的进程(每个进程都只加载一部分)

   更多进程中应该也会有更多的就绪进程，从而提高CPU利用率

3. 进程可以比内存大(逻辑地址可以比物理地址大）

   例:设物理内存64KB,1KB/页,则物理地址需要16位，而逻辑地址可以是28位!

4. 虚拟存储:Large as you wish !

### 2、 虚拟存储技术的特征

- 不连续性

  物理内存分配的不连续

- 部分交换

  虚拟存储的调入和调出是对部分虚拟地址空间进行的

- 大空间

  总容量不超过物理内存和外存交换区容量之和

### 3、 虚拟存储技术必要的支持

- 硬件支持:内存管理硬件必须要支持分页/分段

  需要支持动态地址转换等,如早期UNIX因运行平台的处理器不支持分页/分段而不支持虚存

- 软件支持:

  OS必须管理内存与外存之间的页/段/段和页的移动

  除一些老式PC操作系统(如MS-DOS)和专用系统外，所有重要的0S均支持虚存

### 4、虚拟存储的三种管理

#### 页式管理

```
寄存器：基址寄存器中存放基址地址（首地址）
页表
基地址 + CPU给定的虚拟地址的偏移值 =  物理地址
最后用物理地址去主存中查找。
```

- 页式虚拟存储器构成：全相联映像

![](F:\自考\计算机系统结构\img\2020-05-28_131416.jpg)

- 目录表法

  ![](F:\自考\计算机系统结构\img\2020-05-28_131904.jpg)

##### 页面替换算法

- 随机算法
- 先进先出算法
- 近期最少使用算法
- 替换算法LRU

##### TLB

  		页表可能会非常大,从而占用内存也非常大,通常也对页表进行分页,存储到虚拟内存里

 例:假设逻辑地址只有32位,每页4KB，则一个进程的页表就可能有20个表项!

 进程运行时,它的部分页表必须在内存里（包括正在使用页面对应的表项)

##### 优化：TLB快表

![](F:\自考\计算机系统结构\img\2020-05-28_141425.jpg)

##### 优化：经过散列(hash)访问TLB快表

![](F:\自考\计算机系统结构\img\2020-05-28_141908.jpg)

#### 段式管理

页式有大小，段式没有固定大小

段号 + 寄存器 ----> 段表  +  段内偏移值  =  实际地址  ----- > 访问主存储器

![](F:\自考\计算机系统结构\img\2020-05-28_142554.jpg)

#### 段页式管理

 结合分页和分段的优点,克服两者的缺点

- 基本原理

 将程序按逻辑结构划分成若干段,每个段进一步划分成若干个页

 将内存划分成许多小的帧,帧与页大小相等

 OS为每个进程建立并维护一个段表,为每个段建立并维护一个页表

- 缺点：有点浪费

## 三、高速缓冲存储器

## 四、三级存储体系